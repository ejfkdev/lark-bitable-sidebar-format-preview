{"version":3,"file":"static/js/index.52b74106.js","sources":["webpack://lark-bitable-sidebar-format-preview/./src/App.tsx","webpack://lark-bitable-sidebar-format-preview/./src/modern.runtime.ts","webpack://lark-bitable-sidebar-format-preview/"],"sourcesContent":["import { MarkdownRender, Radio, RadioGroup } from '@douyinfe/semi-ui';\nimport './index.css';\nimport { useEffect, useRef, useState } from 'react';\nimport hljs from 'highlight.js';\nimport { bitable } from '@lark-base-open/js-sdk';\nimport * as prettier from 'prettier/standalone';\nimport * as parserBabel from 'prettier/plugins/babel';\nimport * as parserYaml from 'prettier/plugins/yaml';\nimport * as parserGraphql from 'prettier/plugins/graphql';\nimport * as parserHtml from 'prettier/plugins/html';\nimport * as parserMarkdown from 'prettier/plugins/markdown';\nimport * as parserEstree from 'prettier/plugins/estree';\nimport * as parserTypescript from 'prettier/plugins/typescript';\n\nexport default function Index() {\n  const updateTheme = async (theme: string) => {\n    if (theme === 'DARK') {\n      // 设置为暗黑主题\n      document.body.setAttribute('arco-theme', 'dark');\n      document.body.setAttribute('theme-mode', 'dark');\n    } else {\n      // 恢复亮色主题\n      document.body.removeAttribute('arco-theme');\n      document.body.removeAttribute('theme-mode');\n    }\n  };\n  bitable.bridge.getTheme().then(theme => updateTheme(theme));\n  bitable.bridge.onThemeChange(event => {\n    updateTheme(event.data.theme);\n  });\n  return <BitableComponent />;\n}\n\nconst parserMap: any = {\n  html: 'html',\n  xml: 'html',\n  markdown: 'markdown',\n  css: 'css',\n  scss: 'css',\n  less: 'css',\n  yaml: 'yaml',\n  graphql: 'graphql',\n  pug: 'pug',\n  json: 'json',\n};\n\nconst BitableComponent = () => {\n  const [mode, setMode] = useState('markdown');\n  const [content, setContent] = useState('');\n  const [theme, setTheme] = useState('light');\n  const contentRef = useRef<HTMLElement | null>(null);\n  bitable.bridge.getTheme().then(theme => setTheme(theme.toLowerCase()));\n  // 获取当前打开的表格\n  useEffect(() => {\n    hljs.highlightAll();\n    const off = bitable.base.onSelectionChange(event => {\n      console.log(event.data);\n      if (!event.data.tableId || !event.data.fieldId || !event.data.recordId) {\n        return;\n      }\n      bitable.base\n        .getTable(event.data.tableId)\n        .then(table =>\n          table.getCellString(event.data.fieldId!, event.data.recordId!),\n        )\n        .then(str => {\n          setContent(str);\n        })\n        .catch(e => console.log(e));\n    });\n    const off2 = bitable.bridge.onThemeChange(event => {\n      setTheme(event.data.theme.toLowerCase());\n    });\n    return () => {\n      off();\n      off2();\n    };\n  }, []);\n  useEffect(() => {\n    import(`@public/css/atom-one-${theme}.css`).catch(err => {\n      console.error(`Failed to load theme: ${err}`);\n    });\n  }, [theme]);\n  useEffect(() => {\n    const fn = async () => {\n      if (contentRef.current && mode === 'code') {\n        const result = hljs.highlightAuto(content);\n        console.log(result);\n        let txt = result.value;\n        try {\n          if (parserMap[result.language ?? '']) {\n            txt = await prettier.format(\n              content.replaceAll('<', '&lt;').replaceAll('>', '&gt;'),\n              {\n                parser: parserMap[result.language ?? ''] ?? '',\n                plugins: [\n                  parserBabel,\n                  parserYaml,\n                  parserGraphql,\n                  parserHtml,\n                  parserMarkdown,\n                  parserEstree,\n                  parserTypescript,\n                ],\n              },\n            );\n          }\n        } catch (error) {}\n        contentRef.current.innerHTML = txt;\n      }\n    };\n    fn();\n  }, [content, mode]);\n\n  return (\n    <div className=\"flex flex-col items-center w-screen max-h-screen\">\n      <RadioGroup\n        className=\"flex-shrink-0\"\n        defaultValue={mode}\n        aria-label=\"markdown/code\"\n        type=\"button\"\n        buttonSize=\"large\"\n        onChange={e => setMode(e.target.value)}\n      >\n        <Radio value={`markdown`}>\n          <div className=\"flex items-center gap-2\">\n            <span className=\"streamline--markdown-circle-programming\"></span>\n            markdown\n          </div>\n        </Radio>\n        <Radio value={`code`}>\n          <div className=\"flex items-center gap-2\">\n            <span className=\"fluent--code-circle-32-regular\"></span>\n            code\n          </div>\n        </Radio>\n      </RadioGroup>\n      <div className=\"relative flex flex-grow mb-4 p-4 w-screen text-wrap break-all whitespace-break-spaces overflow-y-auto\">\n        {mode === 'markdown' && (\n          <MarkdownRender className=\"p-4 grow\" raw={content} format=\"md\" />\n        )}\n        {mode === 'code' && (\n          <pre className=\"flex w-full grow\">\n            <code\n              ref={contentRef}\n              className={`grow w-full p-4 text-wrap break-all whitespace-break-spaces ${\n                theme === 'dark' ? 'hljs dark' : 'hljs'\n              }`}\n            ></code>\n          </pre>\n        )}\n      </div>\n    </div>\n  );\n};\n","import { defineRuntimeConfig } from '@modern-js/runtime';\n\nexport default defineRuntimeConfig({});\n","import \"core-js\";"],"names":["Index","updateTheme","theme","document","body","setAttribute","removeAttribute","bitable","then","event","data","BitableComponent","parserMap","html","xml","markdown","css","scss","less","yaml","graphql","pug","json","mode","setMode","useState","content","setContent","setTheme","contentRef","useRef","toLowerCase","useEffect","hljs","off","console","log","tableId","fieldId","recordId","table","getCellString","str","catch","e","off2","concat","err","error","fn","current","result","txt","value","language","prettier","replaceAll","parser","plugins","parserBabel","parserYaml","parserGraphql","parserHtml","parserMarkdown","parserEstree","parserTypescript","innerHTML","className","RadioGroup","defaultValue","type","buttonSize","onChange","target","Radio","MarkdownRender","raw","format","ref","defineRuntimeConfig","window","__assetPrefix__"],"mappings":"mrBAce,SAASA,IACtB,I,EAAMC,G,EAAc,kBAAOC,CAAK,EAC1BA,AAAU,SAAVA,GAEFC,SAASC,IAAI,CAACC,YAAY,CAAC,aAAc,QACzCF,SAASC,IAAI,CAACC,YAAY,CAAC,aAAc,UAGzCF,SAASC,IAAI,CAACE,eAAe,CAAC,cAC9BH,SAASC,IAAI,CAACE,eAAe,CAAC,cAElC,G,SAV2BJ,CAAK,E,iCAehC,OAJAK,EAAAA,EAAAA,CAAAA,MAAAA,CAAAA,QAAuB,GAAGC,IAAI,CAACN,AAAAA,GAASD,EAAYC,IACpDK,EAAAA,EAAAA,CAAAA,MAAAA,CAAAA,aAA4B,CAACE,AAAAA,IAC3BR,EAAYQ,EAAMC,IAAI,CAACR,KAAK,CAC9B,GACO,UAACS,EAAAA,CAAAA,EACV,CAEA,IAAMC,EAAiB,CACrBC,KAAM,OACNC,IAAK,OACLC,SAAU,WACVC,IAAK,MACLC,KAAM,MACNC,KAAM,MACNC,KAAM,OACNC,QAAS,UACTC,IAAK,MACLC,KAAM,MACR,EAEMX,EAAmBA,KACvB,GAAM,CAACY,EAAMC,EAAQ,CAAGC,AAAAA,CAAAA,EAAAA,EAAAA,QAAAA,AAAAA,EAAS,YAC3B,CAACC,EAASC,EAAW,CAAGF,AAAAA,CAAAA,EAAAA,EAAAA,QAAAA,AAAAA,EAAS,IACjC,CAACvB,EAAO0B,EAAS,CAAGH,AAAAA,CAAAA,EAAAA,EAAAA,QAAAA,AAAAA,EAAS,SAC7BI,EAAaC,AAAAA,CAAAA,EAAAA,EAAAA,MAAAA,AAAAA,EAA2B,MAgE9C,OA/DAvB,EAAAA,EAAAA,CAAAA,MAAAA,CAAAA,QAAuB,GAAGC,IAAI,CAACN,AAAAA,GAAS0B,EAAS1B,EAAM6B,WAAW,KAElEC,AAAAA,CAAAA,EAAAA,EAAAA,SAAAA,AAAAA,EAAU,KACRC,EAAAA,CAAAA,CAAAA,YAAiB,GACjB,IAAMC,EAAM3B,EAAAA,EAAAA,CAAAA,IAAAA,CAAAA,iBAA8B,CAACE,AAAAA,IAEzC,GADA0B,QAAQC,GAAG,CAAC3B,EAAMC,IAAI,EAClB,EAACD,EAAMC,IAAI,CAAC2B,OAAO,GAAI,CAAC5B,EAAMC,IAAI,CAAC4B,OAAO,GAAI,CAAC7B,EAAMC,IAAI,CAAC6B,QAAQ,CAGtEhC,EAAAA,EAAAA,CAAAA,IAAAA,CAAAA,QACW,CAACE,EAAMC,IAAI,CAAC2B,OAAO,EAC3B7B,IAAI,CAACgC,AAAAA,GACJA,EAAMC,aAAa,CAAChC,EAAMC,IAAI,CAAC4B,OAAO,CAAG7B,EAAMC,IAAI,CAAC6B,QAAS,GAE9D/B,IAAI,CAACkC,AAAAA,IACJf,EAAWe,EACb,GACCC,KAAK,CAACC,AAAAA,GAAKT,QAAQC,GAAG,CAACQ,GAC5B,GACMC,EAAOtC,EAAAA,EAAAA,CAAAA,MAAAA,CAAAA,aAA4B,CAACE,AAAAA,IACxCmB,EAASnB,EAAMC,IAAI,CAACR,KAAK,CAAC6B,WAAW,GACvC,GACA,MAAO,KACLG,IACAW,GACF,CACF,EAAG,EAAE,EACLb,AAAAA,CAAAA,EAAAA,EAAAA,SAAAA,AAAAA,EAAU,KACR,QAAO,cAA6Bc,MAAAA,CAAL5C,EAAK4C,SAAQH,KAAK,CAACI,AAAAA,IAChDZ,QAAQa,KAAK,CAAC,yBAA4BF,MAAAA,CAAHC,GACzC,EACF,EAAG,CAAC7C,EAAM,EACV8B,AAAAA,CAAAA,EAAAA,EAAAA,SAAAA,AAAAA,EAAU,K,MA4BRiB,C,EA3BW,oBACT,GAAIpB,EAAWqB,OAAO,EAAI3B,AAAS,SAATA,EAAiB,CACzC,IAIgB4B,EAIUA,EAAVvC,EARVuC,EAASlB,EAAAA,CAAAA,CAAAA,aAAkB,CAACP,GAClCS,QAAQC,GAAG,CAACe,GACZ,IAAIC,EAAMD,EAAOE,KAAK,CACtB,GAAI,CACEzC,CAAS,CAACuC,AAAe,OAAfA,CAAAA,EAAAA,EAAOG,QAAQ,AAAD,GAAdH,AAAAA,KAAAA,IAAAA,EAAAA,EAAmB,GAAG,EAClCC,CAAAA,EAAM,MAAMG,EAAAA,EAAe,CACzB7B,EAAQ8B,UAAU,CAAC,IAAK,QAAQA,UAAU,CAAC,IAAK,QAChD,CACEC,OAAQ7C,AAAgC,OAAhCA,CAAAA,EAAAA,CAAS,CAACuC,AAAe,OAAfA,CAAAA,EAAAA,EAAOG,QAAQ,AAAD,GAAdH,AAAAA,KAAAA,IAAAA,EAAAA,EAAmB,GAAG,AAAD,GAA/BvC,AAAAA,KAAAA,IAAAA,EAAAA,EAAoC,GAC5C8C,QAAS,CACPC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EAEJ,EAAC,CAGP,CAAE,MAAOjB,EAAO,CAAC,CACjBnB,EAAWqB,OAAO,CAACgB,SAAS,CAAGd,CACjC,CACF,G,6CAEF,EAAG,CAAC1B,EAASH,EAAK,EAGhB,WAAC,OAAI4C,UAAU,mD,UACb,WAACC,EAAAA,EAAUA,CAAAA,CACTD,UAAU,gBACVE,aAAc9C,EACd,aAAW,gBACX+C,KAAK,SACLC,WAAW,QACXC,SAAU5B,AAAAA,GAAKpB,EAAQoB,EAAE6B,MAAM,CAACpB,KAAK,E,UAErC,UAACqB,EAAAA,EAAKA,CAAAA,CAACrB,MAAO,W,SACZ,WAAC,OAAIc,UAAU,0B,UACb,UAAC,QAAKA,UAAU,yC,GAAgD,W,KAIpE,UAACO,EAAAA,EAAKA,CAAAA,CAACrB,MAAO,O,SACZ,WAAC,OAAIc,UAAU,0B,UACb,UAAC,QAAKA,UAAU,gC,GAAuC,O,QAK7D,WAAC,OAAIA,UAAU,wG,UACZ5C,AAAS,aAATA,GACC,UAACoD,EAAAA,EAAcA,CAAAA,CAACR,UAAU,WAAWS,IAAKlD,EAASmD,OAAO,I,GAE3DtD,AAAS,SAATA,GACC,UAAC,OAAI4C,UAAU,mB,SACb,UAAC,QACCW,IAAKjD,EACLsC,UAAW,+DAC8BrB,MAAAA,CAAvC5C,AAAU,SAAVA,EAAmB,YAAc,O,UAQjD,C,qECxJe6E,IAAAA,EAAAA,AAAAA,CAAAA,EAAAA,A,SAAAA,EAAAA,AAAAA,EAAoB,CAAC,E,4rFCFpCC,CAAAA,OAAOC,eAAe,CAAG,G"}